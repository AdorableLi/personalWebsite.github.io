"use strict";(self["webpackChunkhappy_birthday"]=self["webpackChunkhappy_birthday"]||[]).push([[722],{2648:function(t,e,s){function n(t,e,s,n){let i=String(a(Number(t),Number(e),s).toFixed(n+1)),o=Number(i.slice(0,i.length-1));return o}function i(t){return Math.floor(t)===t}function o(t){var e={times:1,num:0};if(i(t))return e.num=t,e;var s=t+"",n=s.indexOf("."),o=s.substr(n+1).length,a=Math.pow(10,o),l=parseInt(t*a+.5,10);return e.times=a,e.num=l,e}function a(t,e,s){var n=o(t),i=o(e),a=n.num,l=i.num,h=n.times,r=i.times,m=h>r?h:r,u=null;switch(s){case"add":return u=h===r?a+l:h>r?a+l*(h/r):a*(r/h)+l,u/m;case"sub":return u=h===r?a-l:h>r?a-l*(h/r):a*(r/h)-l,u/m;case"mul":return u=a*l/(h*r),u;case"div":return u=a/l/(h/r),u}}s.d(e,{R7:function(){return n}})},6722:function(t,e,s){s.r(e),s.d(e,{default:function(){return b}});var n=s(6252);const i=t=>((0,n.dD)("data-v-ce842164"),t=t(),(0,n.Cn)(),t),o={class:"container"},a=i((()=>(0,n._)("div",{class:""},"此页面除canvas拖动缩放以外的功能均待实现",-1))),l={class:"scale-button"},h=(0,n.Uk)("点击上传"),r=i((()=>(0,n._)("div",{slot:"tip",class:"el-upload__tip"},"只能上传jpg/png文件，且不超过500kb",-1))),m=i((()=>(0,n._)("div",{id:"img-container",class:"img-container"},[(0,n._)("div",{id:"canvas-shell",class:"canvas-shell"},[(0,n._)("canvas",{id:"canvas"})])],-1)));function u(t,e,s,i,u,d){const c=(0,n.up)("el-button"),p=(0,n.up)("el-upload");return(0,n.wg)(),(0,n.iD)("div",o,[a,(0,n._)("div",l,[(0,n._)("button",{onClick:e[0]||(e[0]=e=>t.zoom("add"))},"+"),(0,n._)("button",{onClick:e[1]||(e[1]=e=>t.zoom("sub"))},"-")]),(0,n.Wm)(p,{class:"upload-demo",action:"https://jsonplaceholder.typicode.com/posts/","on-preview":d.handlePreview,"on-remove":d.handleRemove,"on-success":d.handleSuccess,"before-remove":d.beforeRemove,multiple:"",limit:3,"on-exceed":d.handleExceed,"file-list":t.fileList},{default:(0,n.w5)((()=>[(0,n.Wm)(c,{size:"small",type:"primary"},{default:(0,n.w5)((()=>[h])),_:1}),r])),_:1},8,["on-preview","on-remove","on-success","before-remove","on-exceed","file-list"]),m])}function d(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}var c=s(2648);class p{constructor(t={height:0,shellName:"",outDomName:""}){d(this,"maxOffset",{x:0,y:0}),d(this,"transSet",{x:0,y:0}),d(this,"x",0),d(this,"y",0),d(this,"multiple",1),d(this,"outDomCoordinate",""),d(this,"onMousedown",(t=>{0===t.button&&(this.x=t.clientX-this.transSet.x,this.y=t.clientY-this.transSet.y,window.addEventListener("mousemove",this.onMousemove),window.addEventListener("mouseup",this.onMouseup))})),d(this,"onMousemove",(t=>{this.transSet.x=(0,c.R7)(t.clientX,this.x,"sub",2),this.transSet.y=(0,c.R7)(t.clientY,this.y,"sub",2),this.paint()})),d(this,"onMouseup",(()=>{window.removeEventListener("mousemove",this.onMousemove),window.removeEventListener("mouseup",this.onMouseup)})),d(this,"onWheel",(t=>{const e=Number(this.multiple).toFixed(1);t.deltaY<0&&e<4?this.multiple=(0,c.R7)(this.multiple,.1,"add",1):t.deltaY>=0&&e>1&&(this.multiple=(0,c.R7)(this.multiple,.1,"sub",1),this.transSet={x:0,y:0}),this.handleOffset(),this.handleTransform()})),d(this,"handleOffset",(()=>{let{width:t,height:e}=this.shell.style;t=t.replace(/px/g,""),e=e.replace(/px/g,""),this.maxOffset={x:(t*this.multiple-324)/2/this.multiple,y:(e*this.multiple-576)/2/this.multiple}})),d(this,"handleBorder",(()=>{let t,e;const{top:s,left:n,right:i,bottom:o}=this.shell.getBoundingClientRect(),{outDomTop:a,outDomLeft:l,outDomRight:h,outDomBottom:r}=this.outDomCoordinate;return s<a&&o>r?e=this.transSet.y:s>=a&&o>r?e=Math.min(`${this.maxOffset.y}`,this.transSet.y):s<a&&o<=r?e=Math.max(`-${this.maxOffset.y}`,this.transSet.y):s==a&&o==r&&(e=0),n<l&&i>h?t=this.transSet.x:n>=l&&i>h?t=Math.min(`${this.maxOffset.x}`,this.transSet.x):n<l&&i<=h?t=Math.max(`-${this.maxOffset.x}`,this.transSet.x):n==l&&i==h&&(t=0),{transX:t,transY:e}})),d(this,"handleTransform",(()=>{this.shell.style.transform=`scale(${this.multiple}) translate(${this.transSet.x}px, ${this.transSet.y}px)`})),this.shell=document.getElementById(t.shellName),this.shell.style.width="324px",this.shell.style.height=`${t.height}px`,this.outDom=document.getElementById(t.outDomName),this.shell.addEventListener("mousedown",this.onMousedown),this.shell.addEventListener("wheel",this.onWheel);const{top:e,left:s,right:n,bottom:i}=this.outDom.getBoundingClientRect();this.outDomCoordinate={outDomTop:e,outDomLeft:s,outDomRight:n,outDomBottom:i},this.handleOffset()}paint(){const{transX:t,transY:e}=this.handleBorder();this.transSet={x:t,y:e},this.handleTransform()}}var f={name:"convertImgIntoCanvas",components:{},data:()=>({fileList:[{name:"food.jpeg",url:"https://fuss10.elemecdn.com/3/63/4e7f3a15429bfda99bce42a18cdd1jpeg.jpeg?imageMogr2/thumbnail/360x360/format/webp/quality/100"},{name:"food2.jpeg",url:"https://fuss10.elemecdn.com/3/63/4e7f3a15429bfda99bce42a18cdd1jpeg.jpeg?imageMogr2/thumbnail/360x360/format/webp/quality/100"}]}),computed:{},mounted(){const t="https://ts1.cn.mm.bing.net/th/id/R-C.d8dfd08893b58d08d74b38ad8870a48d?rik=9KBqff6Rai035Q&riu=http%3a%2f%2fstatic.cntonan.com%2fuploadfile%2f2019%2f0214%2f20190214104244pwm1xxsdikh.jpg&ehk=MOxI2n5nY44gO%2fKsNYWAuEBvcRwSmkRVNb4dTS6Gk%2bY%3d&risl=&pid=ImgRaw&r=0",e=1125,s=2436,{width:n,height:i,multiple:o}=this.handleShellWidthHeight(e,s);let a={height:i,shellName:"canvas-shell",outDomName:"img-container"};new p(a);let l=document.getElementById("canvas"),h=l.getContext("2d"),r=new Image;r.src=t,r.onload=()=>{h.drawImage(r,0,0,e,s)},l.width=e,l.height=s,l.style.transform=`scale(${o})`},methods:{handleRemove(t,e){console.log(t,e)},handlePreview(t){console.log(t)},handleSuccess(t,e,s){console.log(t,e,s)},handleExceed(t,e){this.$message.warning(`当前限制选择 3 个文件，本次选择了 ${t.length} 个文件，共选择了 ${t.length+e.length} 个文件`)},beforeRemove(t,e){return this.$confirm(`确定移除 ${t.name}？`)},handleShellWidthHeight(t,e){let s=324,n=(0,c.R7)(324,t,"div",6),i=(0,c.R7)(e,n,"mul",6);return{width:s,height:i,multiple:n}}}},g=s(3744);const v=(0,g.Z)(f,[["render",u],["__scopeId","data-v-ce842164"]]);var b=v}}]);
//# sourceMappingURL=722.8acf090f.js.map