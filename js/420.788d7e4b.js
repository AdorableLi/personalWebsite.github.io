"use strict";(self["webpackChunkhappy_birthday"]=self["webpackChunkhappy_birthday"]||[]).push([[420],{2648:function(t,e,s){function n(t,e,s,n){let i=String(a(Number(t),Number(e),s).toFixed(n+1)),o=Number(i.slice(0,i.length-1));return o}function i(t){return Math.floor(t)===t}function o(t){var e={times:1,num:0};if(i(t))return e.num=t,e;var s=t+"",n=s.indexOf("."),o=s.substr(n+1).length,a=Math.pow(10,o),h=parseInt(t*a+.5,10);return e.times=a,e.num=h,e}function a(t,e,s){var n=o(t),i=o(e),a=n.num,h=i.num,l=n.times,m=i.times,r=l>m?l:m,u=null;switch(s){case"add":return u=l===m?a+h:l>m?a+h*(l/m):a*(m/l)+h,u/r;case"sub":return u=l===m?a-h:l>m?a-h*(l/m):a*(m/l)-h,u/r;case"mul":return u=a*h/(l*m),u;case"div":return u=a/h/(l/m),u}}s.d(e,{R7:function(){return n}})},2420:function(t,e,s){s.r(e),s.d(e,{default:function(){return b}});var n=s(6252);const i=t=>((0,n.dD)("data-v-b2a13cf6"),t=t(),(0,n.Cn)(),t),o={class:"container"},a=i((()=>(0,n._)("div",{class:""},"此页面除canvas拖动缩放以外的功能均待实现",-1))),h={class:"scale-button"},l=(0,n.Uk)("点击上传"),m=i((()=>(0,n._)("div",{slot:"tip",class:"el-upload__tip"},"只能上传jpg/png文件，且不超过500kb",-1))),r=i((()=>(0,n._)("div",{id:"img-container",class:"img-container"},[(0,n._)("div",{id:"canvas-shell",class:"canvas-shell"},[(0,n._)("canvas",{id:"canvas"})])],-1)));function u(t,e,s,i,u,d){const c=(0,n.up)("el-button"),f=(0,n.up)("el-upload");return(0,n.wg)(),(0,n.iD)("div",o,[a,(0,n._)("div",h,[(0,n._)("button",{onClick:e[0]||(e[0]=t=>d.zoom(-1))},"+"),(0,n._)("button",{onClick:e[1]||(e[1]=t=>d.zoom(1))},"-")]),(0,n.Wm)(f,{class:"upload-demo",action:"https://jsonplaceholder.typicode.com/posts/","on-preview":d.handlePreview,"on-remove":d.handleRemove,"on-success":d.handleSuccess,"before-remove":d.beforeRemove,multiple:"",limit:3,"on-exceed":d.handleExceed,"file-list":t.fileList},{default:(0,n.w5)((()=>[(0,n.Wm)(c,{size:"small",type:"primary"},{default:(0,n.w5)((()=>[l])),_:1}),m])),_:1},8,["on-preview","on-remove","on-success","before-remove","on-exceed","file-list"]),r])}function d(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}var c=s(2648);class f{constructor(t={height:0,shellName:"",outDomName:""}){d(this,"maxOffset",{x:0,y:0}),d(this,"transSet",{x:0,y:0}),d(this,"x",0),d(this,"y",0),d(this,"multiple",1),d(this,"outDomCoordinate",""),d(this,"handleOutDomRect",(()=>{const{top:t,left:e,right:s,bottom:n}=this.outDom.getBoundingClientRect();this.outDomCoordinate={outDomTop:t,outDomLeft:e,outDomRight:s,outDomBottom:n}})),d(this,"onMousedown",(t=>{0===t.button&&(this.x=t.clientX-this.transSet.x,this.y=t.clientY-this.transSet.y,window.addEventListener("mousemove",this.onMousemove),window.addEventListener("mouseup",this.onMouseup))})),d(this,"onMousemove",(t=>{this.transSet.x=(0,c.R7)(t.clientX,this.x,"sub",2),this.transSet.y=(0,c.R7)(t.clientY,this.y,"sub",2),this.paint()})),d(this,"onMouseup",(()=>{window.removeEventListener("mousemove",this.onMousemove),window.removeEventListener("mouseup",this.onMouseup)})),d(this,"onWheel",(t=>{const e=Number(this.multiple).toFixed(1);t.deltaY<0&&e<4?this.multiple=(0,c.R7)(this.multiple,.1,"add",1):t.deltaY>=0&&e>1&&(this.multiple=(0,c.R7)(this.multiple,.1,"sub",1),this.transSet={x:0,y:0}),this.handleOffset(),this.handleTransform()})),d(this,"handleOffset",(()=>{let{width:t,height:e}=this.shell.style;t=t.replace(/px/g,""),e=e.replace(/px/g,""),this.maxOffset={x:(t*this.multiple-324)/2/this.multiple,y:(e*this.multiple-576)/2/this.multiple}})),d(this,"handleBorder",(()=>{let t,e;const{top:s,left:n,right:i,bottom:o,height:a}=this.shell.getBoundingClientRect(),{outDomTop:h,outDomLeft:l,outDomRight:m,outDomBottom:r}=this.outDomCoordinate;return s<h&&o>r?e=Math.min(`${this.maxOffset.y}`,this.transSet.y):s>h&&o<r?e=this.transSet.y>0?Math.min(""+-this.maxOffset.y,this.transSet.y):Math.max(`${this.maxOffset.y}`,this.transSet.y):s>=h&&o>r?e=Math.min(this.maxOffset.y,this.transSet.y):s<h&&o<=r?e=Math.max(""+-this.maxOffset.y,this.transSet.y):s==h&&o==r&&(e=0),n<l&&i>m||n>=l&&i>m?t=Math.min(`${this.maxOffset.x}`,this.transSet.x):n<l&&i<=m?t=Math.max(""+-this.maxOffset.x,this.transSet.x):n==l&&i==m&&(t=0),{transX:t,transY:e}})),d(this,"handleTransform",(()=>{this.shell.style.transform=`scale(${this.multiple}) translate(${this.transSet.x}px, ${this.transSet.y}px)`})),this.shell=document.getElementById(t.shellName),this.shell.style.width="324px",this.shell.style.height=`${t.height}px`,this.outDom=document.getElementById(t.outDomName),this.shell.addEventListener("mousedown",this.onMousedown),this.shell.addEventListener("wheel",this.onWheel),this.handleOutDomRect(),this.handleOffset(),this.handleTransform()}paint(){const{transX:t,transY:e}=this.handleBorder();this.transSet={x:t,y:e},this.handleTransform()}}let p;var g={name:"convertImgIntoCanvas",components:{},data:()=>({fileList:[{name:"food.jpeg",url:"https://fuss10.elemecdn.com/3/63/4e7f3a15429bfda99bce42a18cdd1jpeg.jpeg?imageMogr2/thumbnail/360x360/format/webp/quality/100"},{name:"food2.jpeg",url:"https://fuss10.elemecdn.com/3/63/4e7f3a15429bfda99bce42a18cdd1jpeg.jpeg?imageMogr2/thumbnail/360x360/format/webp/quality/100"}]}),computed:{},mounted(){const t="https://img1.baidu.com/it/u=3861296666,2632273690&fm=253&fmt=auto&app=138&f=JPEG?w=667&h=500",e=667,s=500,{width:n,height:i,multiple:o}=this.handleShellWidthHeight(e,s);let a={height:i,shellName:"canvas-shell",outDomName:"img-container"};p=new f(a);let h=document.getElementById("canvas"),l=h.getContext("2d"),m=new Image;m.src=t,m.onload=()=>{l.drawImage(m,0,0,e,s)},h.width=e,h.height=s,h.style.transform=`scale(${o})`},methods:{handleRemove(t,e){console.log(t,e)},handlePreview(t){console.log(t)},handleSuccess(t,e,s){console.log(t,e,s)},handleExceed(t,e){this.$message.warning(`当前限制选择 3 个文件，本次选择了 ${t.length} 个文件，共选择了 ${t.length+e.length} 个文件`)},beforeRemove(t,e){return this.$confirm(`确定移除 ${t.name}？`)},handleShellWidthHeight(t,e){let s=324,n=(0,c.R7)(324,t,"div",6),i=(0,c.R7)(e,n,"mul",6);return{width:s,height:i,multiple:n}},zoom(t){let e={deltaY:t};p.onWheel(e)}}},v=s(3744);const x=(0,v.Z)(g,[["render",u],["__scopeId","data-v-b2a13cf6"]]);var b=x}}]);
//# sourceMappingURL=420.788d7e4b.js.map