"use strict";(self["webpackChunkhappy_birthday"]=self["webpackChunkhappy_birthday"]||[]).push([[881],{2648:function(t,e,s){function i(t,e,s,i){let n=String(a(Number(t),Number(e),s).toFixed(i+1)),o=Number(n.slice(0,n.length-1));return o}function n(t){return Math.floor(t)===t}function o(t){var e={times:1,num:0};if(n(t))return e.num=t,e;var s=t+"",i=s.indexOf("."),o=s.substr(i+1).length,a=Math.pow(10,o),h=parseInt(t*a+.5,10);return e.times=a,e.num=h,e}function a(t,e,s){var i=o(t),n=o(e),a=i.num,h=n.num,l=i.times,r=n.times,m=l>r?l:r,d=null;switch(s){case"add":return d=l===r?a+h:l>r?a+h*(l/r):a*(r/l)+h,d/m;case"sub":return d=l===r?a-h:l>r?a-h*(l/r):a*(r/l)-h,d/m;case"mul":return d=a*h/(l*r),d;case"div":return d=a/h/(l/r),d}}s.d(e,{R7:function(){return i}})},8881:function(t,e,s){s.r(e),s.d(e,{default:function(){return w}});var i=s(6252);const n=t=>((0,i.dD)("data-v-04b79e67"),t=t(),(0,i.Cn)(),t),o={class:"container"},a=n((()=>(0,i._)("div",{class:""},"此页面除canvas拖动缩放以外的功能均待实现",-1))),h={class:"scale-button"},l=(0,i.Uk)("点击上传"),r=n((()=>(0,i._)("div",{slot:"tip",class:"el-upload__tip"},"只能上传jpg/png文件，且不超过500kb",-1))),m=n((()=>(0,i._)("div",{id:"img-container",class:"img-container"},[(0,i._)("div",{id:"canvas-shell",class:"canvas-shell"},[(0,i._)("canvas",{id:"canvas"})])],-1)));function d(t,e,s,n,d,u){const c=(0,i.up)("el-button"),p=(0,i.up)("el-upload");return(0,i.wg)(),(0,i.iD)("div",o,[a,(0,i._)("div",h,[(0,i._)("button",{onClick:e[0]||(e[0]=e=>t.zoom("add"))},"+"),(0,i._)("button",{onClick:e[1]||(e[1]=e=>t.zoom("sub"))},"-")]),(0,i.Wm)(p,{class:"upload-demo",action:"https://jsonplaceholder.typicode.com/posts/","on-preview":u.handlePreview,"on-remove":u.handleRemove,"on-success":u.handleSuccess,"before-remove":u.beforeRemove,multiple:"",limit:3,"on-exceed":u.handleExceed,"file-list":t.fileList},{default:(0,i.w5)((()=>[(0,i.Wm)(c,{size:"small",type:"primary"},{default:(0,i.w5)((()=>[l])),_:1}),r])),_:1},8,["on-preview","on-remove","on-success","before-remove","on-exceed","file-list"]),m])}function u(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}var c=s(2648);class p{constructor(t,e={imgUrl:"",width:0,height:0,shellName:"",outDomName:""}){u(this,"maxOffset",{x:0,y:0}),u(this,"transSet",{x:0,y:0}),u(this,"x",0),u(this,"y",0),u(this,"img",""),u(this,"multiple",1),u(this,"outDomCoordinate",""),u(this,"onMousedown",(t=>{0===t.button&&(this.x=t.clientX-this.transSet.x,this.y=t.clientY-this.transSet.y,window.addEventListener("mousemove",this.onMousemove),window.addEventListener("mouseup",this.onMouseup))})),u(this,"onMousemove",(t=>{this.transSet.x=(0,c.R7)(t.clientX,this.x,"sub",2),this.transSet.y=(0,c.R7)(t.clientY,this.y,"sub",2),this.paint()})),u(this,"onMouseup",(()=>{window.removeEventListener("mousemove",this.onMousemove),window.removeEventListener("mouseup",this.onMouseup)})),u(this,"onWheel",(t=>{const e=Number(this.multiple).toFixed(1);t.deltaY<0&&e<4?this.multiple=(0,c.R7)(this.multiple,.1,"add",1):t.deltaY>=0&&e>1&&(this.multiple=(0,c.R7)(this.multiple,.1,"sub",1),this.transSet={x:0,y:0}),this.handleOffset(),this.handleTransform()})),u(this,"handleOffset",(()=>{let{width:t,height:e}=this.shell.style;t=t.replace(/px/g,""),e=e.replace(/px/g,""),this.maxOffset={x:(t*this.multiple-324)/2/this.multiple,y:(e*this.multiple-576)/2/this.multiple}})),u(this,"handleBorder",(()=>{let t,e;const{top:s,left:i,right:n,bottom:o}=this.shell.getBoundingClientRect(),{outDomTop:a,outDomLeft:h,outDomRight:l,outDomBottom:r}=this.outDomCoordinate;return s<a&&o>r?e=this.transSet.y:s>=a&&o>r?e=Math.min(`${this.maxOffset.y}`,this.transSet.y):s<a&&o<=r?e=Math.max(`-${this.maxOffset.y}`,this.transSet.y):s==a&&o==r&&(e=0),i<h&&n>l?t=this.transSet.x:i>=h&&n>l?t=Math.min(`${this.maxOffset.x}`,this.transSet.x):i<h&&n<=l?t=Math.max(`-${this.maxOffset.x}`,this.transSet.x):i==h&&n==l&&(t=0),{transX:t,transY:e}})),u(this,"handleShellWidthHeight",(()=>{let t=324,e=(0,c.R7)(324,this.options.width,"div",6),s=(0,c.R7)(this.options.height,e,"mul",6);this.canvas.style.transform=`scale(${e})`,this.shell.style.width=`${t}px`,this.shell.style.height=`${s}px`})),u(this,"handleTransform",(()=>{this.shell.style.transform=`scale(${this.multiple}) translate(${this.transSet.x}px, ${this.transSet.y}px)`})),this.canvas=document.getElementById(t),this.options=e,this.width=e.width,this.height=e.height,this.canvas.width=e.width,this.canvas.height=e.height,this.ctx=this.canvas.getContext("2d"),this.shell=document.getElementById(e.shellName),this.handleShellWidthHeight(),this.outDom=document.getElementById(e.outDomName),this.canvas.addEventListener("mousedown",this.onMousedown),this.canvas.addEventListener("wheel",this.onWheel);const{top:s,left:i,right:n,bottom:o}=this.outDom.getBoundingClientRect();this.outDomCoordinate={outDomTop:s,outDomLeft:i,outDomRight:n,outDomBottom:o},this.handleOffset()}draw(){if(this.img)this.ctx.drawImage(this.img,0,0,this.canvas.width,this.canvas.height);else{let t=new Image;t.src=this.options.imgUrl,t.onload=()=>{this.img=t,this.ctx.drawImage(t,0,0,this.canvas.width,this.canvas.height)}}}clear(){this.canvas.width=this.width}paint(){this.clear();const{transX:t,transY:e}=this.handleBorder();this.transSet={x:t,y:e},this.handleTransform(),this.draw()}}var f={name:"convertImgIntoCanvas",components:{},data:()=>({fileList:[{name:"food.jpeg",url:"https://fuss10.elemecdn.com/3/63/4e7f3a15429bfda99bce42a18cdd1jpeg.jpeg?imageMogr2/thumbnail/360x360/format/webp/quality/100"},{name:"food2.jpeg",url:"https://fuss10.elemecdn.com/3/63/4e7f3a15429bfda99bce42a18cdd1jpeg.jpeg?imageMogr2/thumbnail/360x360/format/webp/quality/100"}]}),computed:{},mounted(){const t="https://ts1.cn.mm.bing.net/th/id/R-C.d8dfd08893b58d08d74b38ad8870a48d?rik=9KBqff6Rai035Q&riu=http%3a%2f%2fstatic.cntonan.com%2fuploadfile%2f2019%2f0214%2f20190214104244pwm1xxsdikh.jpg&ehk=MOxI2n5nY44gO%2fKsNYWAuEBvcRwSmkRVNb4dTS6Gk%2bY%3d&risl=&pid=ImgRaw&r=0";let e={imgUrl:t,width:1125,height:2436,shellName:"canvas-shell",outDomName:"img-container"},s=new p("canvas",e);s.draw()},methods:{handleRemove(t,e){console.log(t,e)},handlePreview(t){console.log(t)},handleSuccess(t,e,s){console.log(t,e,s)},handleExceed(t,e){this.$message.warning(`当前限制选择 3 个文件，本次选择了 ${t.length} 个文件，共选择了 ${t.length+e.length} 个文件`)},beforeRemove(t,e){return this.$confirm(`确定移除 ${t.name}？`)}}},g=s(3744);const v=(0,g.Z)(f,[["render",d],["__scopeId","data-v-04b79e67"]]);var w=v}}]);
//# sourceMappingURL=881.c6b863bf.js.map